# ============================================================
# PRODUCTION CONFIGURATION REQUIREMENTS
# ============================================================
# When deploying to production (APP_ENV=production), the application
# validates configuration at startup and will fail if:
#
# 1. Environment & Security:
#    - APP_ENV must be "production"
#    - No localhost URLs (127.0.0.1, ::1, 0.0.0.0)
#    - HTTPS required for external services (Kratos, webhooks)
#
# 2. Database:
#    - DB_PASSWORD must be strong (min 8 chars, not common weak passwords)
#    - DB_SSLMODE must be 'require', 'verify-ca', or 'verify-full' (NOT 'disable')
#    - DB_HOST must not be localhost
#
# 3. Credentials:
#    - CREDENTIAL_MASTER_KEY must be unique and strong (min 32 chars)
#      OR use CREDENTIAL_USE_KMS=true with valid CREDENTIAL_KMS_KEY_ID
#
# 4. Notifications (if enabled):
#    - NOTIFICATION_EMAIL_FROM must not be 'noreply@example.com'
#    - NOTIFICATION_SMTP_PASS required when using SMTP provider
#    - NOTIFICATION_SMTP_TLS must be enabled
#
# 5. Recommended (warnings only):
#    - REDIS_PASSWORD should be set
#    - RETENTION_ENABLED and CLEANUP_ENABLED should be true
#    - METRICS_ENABLED and TRACING_ENABLED for observability
# ============================================================

# Application Configuration
APP_ENV=development  # development or production
SERVER_ADDRESS=:8080

# Logging Configuration
# LOG_LEVEL controls the minimum log level for application logs
# Options: debug, info, warn, error
# - debug: Most verbose, shows all logs including HTTP access logs
# - info: Standard production level, shows important events
# - warn: Only warnings and errors
# - error: Only errors
LOG_LEVEL=info

# HTTP_LOG_LEVEL controls the log level for successful HTTP requests (2xx, 3xx)
# Options: debug, info, warn, error
# - debug: Reduces console noise by hiding successful requests (recommended for development)
# - info: Shows all successful HTTP requests (useful for production monitoring)
# Note: Errors (4xx, 5xx) are always logged at WARN/ERROR level regardless of this setting
HTTP_LOG_LEVEL=debug

# LOG_FORMAT controls the log output format
# Options: json, text
# - json: Structured logging for production (easier to parse and query)
# - text: Human-readable logs for development
LOG_FORMAT=json

# Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=gorax
DB_SSLMODE=disable

# Database Connection Pool Configuration (Performance Tuning)
# Calculation: Max Open = (Concurrent Requests × Queries Per Request) / 2
# Example: (100 requests × 3 queries) / 2 = 150 connections
DB_MAX_OPEN_CONNS=150          # Maximum number of open connections to the database
DB_MAX_IDLE_CONNS=25           # Maximum number of idle connections in the pool
DB_CONN_MAX_LIFETIME=5m        # Maximum lifetime of a connection (e.g., 5m, 1h)
DB_CONN_MAX_IDLE_TIME=10m      # Maximum time a connection can be idle before being closed

# Redis Configuration
REDIS_ADDRESS=localhost:6379
REDIS_PASSWORD=
REDIS_DB=0

# Ory Kratos Configuration
KRATOS_PUBLIC_URL=http://localhost:4433
KRATOS_ADMIN_URL=http://localhost:4434

# Kratos Webhook Secret (for identity sync)
# Generate with: openssl rand -base64 32
KRATOS_WEBHOOK_SECRET=YOUR_WEBHOOK_SECRET_HERE

# OAuth 2.0 Integration Configuration
# Configure OAuth applications for third-party service integrations
# Base URL for OAuth callbacks (must match registered redirect URIs)
OAUTH_BASE_URL=http://localhost:8080

# GitHub OAuth Application
# Register at: https://github.com/settings/developers
# Callback URL: ${OAUTH_BASE_URL}/api/v1/oauth/callback/github
OAUTH_GITHUB_CLIENT_ID=
OAUTH_GITHUB_CLIENT_SECRET=

# Google OAuth Application
# Register at: https://console.cloud.google.com/apis/credentials
# Callback URL: ${OAUTH_BASE_URL}/api/v1/oauth/callback/google
OAUTH_GOOGLE_CLIENT_ID=
OAUTH_GOOGLE_CLIENT_SECRET=

# Slack OAuth Application
# Register at: https://api.slack.com/apps
# Callback URL: ${OAUTH_BASE_URL}/api/v1/oauth/callback/slack
OAUTH_SLACK_CLIENT_ID=
OAUTH_SLACK_CLIENT_SECRET=

# Microsoft OAuth Application
# Register at: https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade
# Callback URL: ${OAUTH_BASE_URL}/api/v1/oauth/callback/microsoft
OAUTH_MICROSOFT_CLIENT_ID=
OAUTH_MICROSOFT_CLIENT_SECRET=

# Twitter/X OAuth Application
# Register at: https://developer.twitter.com/en/portal/projects-and-apps
# Callback URL: ${OAUTH_BASE_URL}/api/v1/oauth/callback/twitter
# Required scopes: tweet.read, users.read, offline.access
# Note: Supports OAuth 2.0 with PKCE for enhanced security
OAUTH_TWITTER_CLIENT_ID=
OAUTH_TWITTER_CLIENT_SECRET=

# LinkedIn OAuth Application
# Register at: https://www.linkedin.com/developers/apps
# Callback URL: ${OAUTH_BASE_URL}/api/v1/oauth/callback/linkedin
# Required scopes: profile, email, openid
# Note: LinkedIn does not support refresh tokens or PKCE
OAUTH_LINKEDIN_CLIENT_ID=
OAUTH_LINKEDIN_CLIENT_SECRET=

# Salesforce OAuth Application
# Register at: https://login.salesforce.com/setup/forcecomSetupPage.apexp (Setup > Apps > App Manager > New Connected App)
# Callback URL: ${OAUTH_BASE_URL}/api/v1/oauth/callback/salesforce
# Required scopes: api, refresh_token, openid, profile, email
# Note: Supports both production (login.salesforce.com) and sandbox (test.salesforce.com)
OAUTH_SALESFORCE_CLIENT_ID=
OAUTH_SALESFORCE_CLIENT_SECRET=
OAUTH_SALESFORCE_ENVIRONMENT=production  # or sandbox

# Auth0 OAuth Application
# Register at: https://{your-tenant}.auth0.com/dashboard (Applications > Create Application)
# Callback URL: ${OAUTH_BASE_URL}/api/v1/oauth/callback/auth0
# Required scopes: openid, profile, email, offline_access
# Note: Requires tenant-specific domain configuration
OAUTH_AUTH0_DOMAIN=your-tenant.auth0.com  # or tenant.us.auth0.com, or custom domain
OAUTH_AUTH0_CLIENT_ID=
OAUTH_AUTH0_CLIENT_SECRET=

# Worker Configuration
WORKER_CONCURRENCY=10
WORKER_QUEUE_URL=

# AWS Configuration (optional, for production)
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_S3_BUCKET=gorax-artifacts
AWS_SQS_QUEUE_URL=

# Message Queue Configuration
# AWS SQS Configuration
# Used for AWS SQS message queue integrations
MQ_SQS_REGION=us-east-1
MQ_SQS_ACCESS_KEY_ID=
MQ_SQS_SECRET_ACCESS_KEY=

# Apache Kafka Configuration
# Comma-separated list of broker addresses
# Example: localhost:9092,localhost:9093 or kafka1.example.com:9092,kafka2.example.com:9092
MQ_KAFKA_BROKERS=localhost:9092
MQ_KAFKA_CONSUMER_GROUP=gorax-consumers

# RabbitMQ Configuration
# AMQP connection URL
# Example: amqp://username:password@hostname:5672/vhost
MQ_RABBITMQ_URL=amqp://guest:guest@localhost:5672/

# Webhook Event Cleanup Configuration
CLEANUP_ENABLED=true
CLEANUP_RETENTION_DAYS=30
CLEANUP_BATCH_SIZE=1000
CLEANUP_SCHEDULE=0 0 * * *  # Cron format: Daily at midnight

# Execution Retention Policy Configuration
RETENTION_ENABLED=true
RETENTION_DEFAULT_DAYS=90        # Default retention period in days
RETENTION_BATCH_SIZE=1000        # Number of executions to delete per batch
RETENTION_RUN_INTERVAL=24h       # How often to run cleanup (e.g., 24h, 12h, 1h)
RETENTION_ENABLE_AUDIT_LOG=true  # Enable audit logging of cleanup operations

# Audit Logging Configuration
AUDIT_ENABLED=true                      # Enable audit logging system
AUDIT_BUFFER_SIZE=100                   # Number of events to buffer before flushing
AUDIT_FLUSH_INTERVAL=5s                 # How often to flush buffered events (e.g., 5s, 10s)
AUDIT_HOT_RETENTION_DAYS=90            # Days to keep in main database (fast queries)
AUDIT_WARM_RETENTION_DAYS=365          # Days to keep in compressed form (slower queries)
AUDIT_COLD_RETENTION_DAYS=2555         # Days to keep in archive storage (7 years for compliance)
AUDIT_ARCHIVE_ENABLED=true             # Enable automatic archival to object storage
AUDIT_ARCHIVE_BUCKET=audit-logs        # S3/GCS bucket for archived logs
AUDIT_PURGE_ENABLED=true               # Enable automatic purging of expired logs

# Observability Configuration

# Metrics (Prometheus)
METRICS_ENABLED=true
METRICS_PORT=9090

# Distributed Tracing (OpenTelemetry)
TRACING_ENABLED=false
TRACING_ENDPOINT=localhost:4317  # OTLP endpoint (Jaeger, Zipkin, etc.)
TRACING_SAMPLE_RATE=1.0          # 0.0 to 1.0 (1.0 = 100% sampling)
TRACING_SERVICE_NAME=gorax

# Error Tracking (Sentry)
SENTRY_ENABLED=false
SENTRY_DSN=                      # Get from https://sentry.io
SENTRY_ENVIRONMENT=development   # development, staging, production
SENTRY_SAMPLE_RATE=1.0           # 0.0 to 1.0 (1.0 = 100% error sampling)

# Notification Configuration
NOTIFICATION_ENABLE_EMAIL=false         # Enable email notifications
NOTIFICATION_ENABLE_SLACK=false         # Enable Slack notifications
NOTIFICATION_ENABLE_INAPP=true          # Enable in-app notifications

# Email Notification Settings
NOTIFICATION_EMAIL_PROVIDER=smtp        # smtp or ses
NOTIFICATION_EMAIL_FROM=noreply@example.com
NOTIFICATION_SMTP_HOST=                 # SMTP server host (e.g., smtp.gmail.com)
NOTIFICATION_SMTP_PORT=587              # SMTP server port
NOTIFICATION_SMTP_USER=                 # SMTP username
NOTIFICATION_SMTP_PASS=                 # SMTP password
NOTIFICATION_SMTP_TLS=true              # Use TLS for SMTP
NOTIFICATION_EMAIL_MAX_RETRIES=3        # Max retry attempts for email
NOTIFICATION_EMAIL_RETRY_DELAY_SECONDS=1

# AWS SES Settings (if using SES provider)
NOTIFICATION_SES_REGION=us-east-1

# Slack Notification Settings
NOTIFICATION_SLACK_WEBHOOK_URL=         # Slack incoming webhook URL
NOTIFICATION_SLACK_MAX_RETRIES=3
NOTIFICATION_SLACK_RETRY_DELAY_SECONDS=1
NOTIFICATION_SLACK_TIMEOUT_SECONDS=30

# In-App Notification Settings
NOTIFICATION_INAPP_RETENTION_DAYS=90    # Days to retain in-app notifications

# Credential Encryption Configuration
# For development, use simple encryption with a master key
# For production, use AWS KMS for secure key management
CREDENTIAL_USE_KMS=false                      # Set to true to use AWS KMS in production
CREDENTIAL_KMS_KEY_ID=                        # AWS KMS key ID or alias (e.g., alias/gorax-credentials or full ARN)
CREDENTIAL_KMS_REGION=us-east-1               # AWS region for KMS (defaults to AWS_REGION if not set)
CREDENTIAL_MASTER_KEY=                        # 32-byte base64 encoded key for dev (ignored if USE_KMS=true)
                                              # Generate with: openssl rand -base64 32

# CORS Configuration
# Comma-separated list of allowed origins
# Development: Can include localhost origins (http://localhost:*, http://127.0.0.1:*)
# Production: Must use HTTPS origins only, no localhost
CORS_ALLOWED_ORIGINS=https://app.gorax.io,https://admin.gorax.io
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS,PATCH
CORS_ALLOWED_HEADERS=Accept,Authorization,Content-Type,X-Tenant-ID
CORS_EXPOSED_HEADERS=Link
CORS_ALLOW_CREDENTIALS=true
CORS_MAX_AGE=300  # Preflight cache duration in seconds

# Security Headers Configuration
# Environment-aware: stricter defaults in production, more permissive in development
SECURITY_HEADER_ENABLE_HSTS=false  # Auto-enabled in production, disabled in development
SECURITY_HEADER_HSTS_MAX_AGE=31536000  # 1 year (development), 2 years (production)
SECURITY_HEADER_CSP_DIRECTIVES=default-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src 'self' ws: wss:
SECURITY_HEADER_FRAME_OPTIONS=SAMEORIGIN  # SAMEORIGIN (dev), DENY (production)

# WebSocket Origin Security Configuration
# Comma-separated list of allowed origins for WebSocket connections
# Protects against Cross-Site WebSocket Hijacking (CSWSH)
# Supports exact matches, wildcard subdomains (*.example.com), and wildcard ports (localhost:*)
# Development: Use localhost with wildcard ports for convenience
# Production: Must use HTTPS origins only, no localhost
# Examples:
#   - Exact: https://app.example.com
#   - Wildcard subdomain: https://*.example.com (matches app.example.com, dev.app.example.com)
#   - Wildcard port: http://localhost:* (matches any port on localhost)
# See docs/WEBSOCKET_SECURITY.md for detailed configuration guide
WEBSOCKET_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173,http://localhost:5174

# WebSocket Connection Limits & Security
# Maximum message size in bytes (default: 512KB)
# Prevents memory exhaustion from large messages
WEBSOCKET_MAX_MESSAGE_SIZE=524288

# Maximum concurrent connections per workflow (default: 50)
# Prevents resource exhaustion from too many concurrent editors
WEBSOCKET_MAX_CONNECTIONS_PER_WORKFLOW=50

# Rate limit for new WebSocket connections per tenant per minute (default: 60)
# Prevents connection flooding attacks
WEBSOCKET_CONNECTIONS_PER_TENANT_PER_MINUTE=60

# AI Workflow Builder Configuration
# Enable the AI-powered workflow builder feature
AI_BUILDER_ENABLED=false               # Set to true to enable AI workflow generation
AI_BUILDER_PROVIDER=openai             # LLM provider: openai, anthropic, or bedrock
AI_BUILDER_API_KEY=                    # API key for the LLM provider (OpenAI or Anthropic)
                                       # For AWS Bedrock, use AWS credentials above instead
AI_BUILDER_MODEL=gpt-4                 # Model ID: gpt-4, gpt-4-turbo, claude-3-opus, etc.
AI_BUILDER_MAX_TOKENS=4096             # Maximum tokens for completion
AI_BUILDER_TEMPERATURE=0.7             # Temperature (0.0-1.0): lower = more focused

# SSRF Protection Configuration
# Server-Side Request Forgery (SSRF) protection for HTTP actions
SSRF_PROTECTION_ENABLED=true           # Enable SSRF protection (highly recommended)
                                       # Blocks requests to private IPs, loopback, and metadata services
                                       # Default blocklist: 127.0.0.0/8, 10.0.0.0/8, 172.16.0.0/12,
                                       # 192.168.0.0/16, 169.254.0.0/16 (AWS/GCP metadata), IPv6 private
SSRF_ALLOWED_NETWORKS=                 # Comma-separated CIDR ranges to explicitly allow
                                       # Example: 192.168.1.0/24,10.0.0.0/8
                                       # Use this to allow internal API calls if needed
SSRF_BLOCKED_NETWORKS=                 # Comma-separated additional CIDR ranges to block
                                       # Example: 203.0.113.0/24
                                       # Use this to block specific public ranges

# Formula Cache Configuration
# Formula expression caching for improved performance
FORMULA_CACHE_ENABLED=true             # Enable formula expression caching (default: true)
                                       # Provides 93-94% performance improvement for repeated formulas
FORMULA_CACHE_SIZE=1000                # Maximum number of compiled expressions to cache (default: 1000)
                                       # Increase for workflows with many unique formulas
FORMULA_CACHE_LOG_INTERVAL=            # Optional: Log cache statistics periodically (e.g., "5m", "1h")
                                       # Leave empty to disable logging (default)

# ============================================================
# Communication Provider Configuration
# ============================================================
# Email and SMS providers for workflow notifications and communications

# SendGrid Email Provider
SENDGRID_API_KEY=

# Mailgun Email Provider
MAILGUN_DOMAIN=
MAILGUN_API_KEY=

# AWS SES Email Provider
AWS_SES_REGION=us-east-1
AWS_SES_ACCESS_KEY_ID=
AWS_SES_SECRET_ACCESS_KEY=

# SMTP Email Provider
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_USE_TLS=true

# Twilio SMS Provider
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_PHONE_NUMBER=

# AWS SNS SMS Provider
AWS_SNS_REGION=us-east-1
AWS_SNS_ACCESS_KEY_ID=
AWS_SNS_SECRET_ACCESS_KEY=

# MessageBird SMS Provider
MESSAGEBIRD_API_KEY=
