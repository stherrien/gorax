# ============================================================
# PRODUCTION CONFIGURATION REQUIREMENTS
# ============================================================
# When deploying to production (APP_ENV=production), the application
# validates configuration at startup and will fail if:
#
# 1. Environment & Security:
#    - APP_ENV must be "production"
#    - No localhost URLs (127.0.0.1, ::1, 0.0.0.0)
#    - HTTPS required for external services (Kratos, webhooks)
#
# 2. Database:
#    - DB_PASSWORD must be strong (min 8 chars, not common weak passwords)
#    - DB_SSLMODE must be 'require', 'verify-ca', or 'verify-full' (NOT 'disable')
#    - DB_HOST must not be localhost
#
# 3. Credentials:
#    - CREDENTIAL_MASTER_KEY must be unique and strong (min 32 chars)
#      OR use CREDENTIAL_USE_KMS=true with valid CREDENTIAL_KMS_KEY_ID
#
# 4. Notifications (if enabled):
#    - NOTIFICATION_EMAIL_FROM must not be 'noreply@example.com'
#    - NOTIFICATION_SMTP_PASS required when using SMTP provider
#    - NOTIFICATION_SMTP_TLS must be enabled
#
# 5. Recommended (warnings only):
#    - REDIS_PASSWORD should be set
#    - RETENTION_ENABLED and CLEANUP_ENABLED should be true
#    - METRICS_ENABLED and TRACING_ENABLED for observability
# ============================================================

# Application Configuration
APP_ENV=development  # development or production
SERVER_ADDRESS=:8080

# Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=gorax
DB_SSLMODE=disable

# Redis Configuration
REDIS_ADDRESS=localhost:6379
REDIS_PASSWORD=
REDIS_DB=0

# Ory Kratos Configuration
KRATOS_PUBLIC_URL=http://localhost:4433
KRATOS_ADMIN_URL=http://localhost:4434

# Kratos Webhook Secret (for identity sync)
# Generate with: openssl rand -base64 32
KRATOS_WEBHOOK_SECRET=YOUR_WEBHOOK_SECRET_HERE

# OAuth2/OIDC Provider Credentials
# Google OAuth2
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=

# GitHub OAuth2
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=

# Microsoft OAuth2
MICROSOFT_CLIENT_ID=
MICROSOFT_CLIENT_SECRET=

# Worker Configuration
WORKER_CONCURRENCY=10
WORKER_QUEUE_URL=

# AWS Configuration (optional, for production)
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_S3_BUCKET=gorax-artifacts
AWS_SQS_QUEUE_URL=

# Webhook Event Cleanup Configuration
CLEANUP_ENABLED=true
CLEANUP_RETENTION_DAYS=30
CLEANUP_BATCH_SIZE=1000
CLEANUP_SCHEDULE=0 0 * * *  # Cron format: Daily at midnight

# Execution Retention Policy Configuration
RETENTION_ENABLED=true
RETENTION_DEFAULT_DAYS=90        # Default retention period in days
RETENTION_BATCH_SIZE=1000        # Number of executions to delete per batch
RETENTION_RUN_INTERVAL=24h       # How often to run cleanup (e.g., 24h, 12h, 1h)
RETENTION_ENABLE_AUDIT_LOG=true  # Enable audit logging of cleanup operations

# Observability Configuration

# Metrics (Prometheus)
METRICS_ENABLED=true
METRICS_PORT=9090

# Distributed Tracing (OpenTelemetry)
TRACING_ENABLED=false
TRACING_ENDPOINT=localhost:4317  # OTLP endpoint (Jaeger, Zipkin, etc.)
TRACING_SAMPLE_RATE=1.0          # 0.0 to 1.0 (1.0 = 100% sampling)
TRACING_SERVICE_NAME=gorax

# Error Tracking (Sentry)
SENTRY_ENABLED=false
SENTRY_DSN=                      # Get from https://sentry.io
SENTRY_ENVIRONMENT=development   # development, staging, production
SENTRY_SAMPLE_RATE=1.0           # 0.0 to 1.0 (1.0 = 100% error sampling)

# Notification Configuration
NOTIFICATION_ENABLE_EMAIL=false         # Enable email notifications
NOTIFICATION_ENABLE_SLACK=false         # Enable Slack notifications
NOTIFICATION_ENABLE_INAPP=true          # Enable in-app notifications

# Email Notification Settings
NOTIFICATION_EMAIL_PROVIDER=smtp        # smtp or ses
NOTIFICATION_EMAIL_FROM=noreply@example.com
NOTIFICATION_SMTP_HOST=                 # SMTP server host (e.g., smtp.gmail.com)
NOTIFICATION_SMTP_PORT=587              # SMTP server port
NOTIFICATION_SMTP_USER=                 # SMTP username
NOTIFICATION_SMTP_PASS=                 # SMTP password
NOTIFICATION_SMTP_TLS=true              # Use TLS for SMTP
NOTIFICATION_EMAIL_MAX_RETRIES=3        # Max retry attempts for email
NOTIFICATION_EMAIL_RETRY_DELAY_SECONDS=1

# AWS SES Settings (if using SES provider)
NOTIFICATION_SES_REGION=us-east-1

# Slack Notification Settings
NOTIFICATION_SLACK_WEBHOOK_URL=         # Slack incoming webhook URL
NOTIFICATION_SLACK_MAX_RETRIES=3
NOTIFICATION_SLACK_RETRY_DELAY_SECONDS=1
NOTIFICATION_SLACK_TIMEOUT_SECONDS=30

# In-App Notification Settings
NOTIFICATION_INAPP_RETENTION_DAYS=90    # Days to retain in-app notifications

# Credential Encryption Configuration
# For development, use simple encryption with a master key
# For production, use AWS KMS for secure key management
CREDENTIAL_USE_KMS=false                      # Set to true to use AWS KMS in production
CREDENTIAL_KMS_KEY_ID=                        # AWS KMS key ID or alias (e.g., alias/gorax-credentials or full ARN)
CREDENTIAL_KMS_REGION=us-east-1               # AWS region for KMS (defaults to AWS_REGION if not set)
CREDENTIAL_MASTER_KEY=                        # 32-byte base64 encoded key for dev (ignored if USE_KMS=true)
                                              # Generate with: openssl rand -base64 32

# CORS Configuration
# Comma-separated list of allowed origins
# Development: Can include localhost origins (http://localhost:*, http://127.0.0.1:*)
# Production: Must use HTTPS origins only, no localhost
CORS_ALLOWED_ORIGINS=https://app.gorax.io,https://admin.gorax.io
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS,PATCH
CORS_ALLOWED_HEADERS=Accept,Authorization,Content-Type,X-Tenant-ID
CORS_EXPOSED_HEADERS=Link
CORS_ALLOW_CREDENTIALS=true
CORS_MAX_AGE=300  # Preflight cache duration in seconds

# Security Headers Configuration
# Environment-aware: stricter defaults in production, more permissive in development
SECURITY_HEADER_ENABLE_HSTS=false  # Auto-enabled in production, disabled in development
SECURITY_HEADER_HSTS_MAX_AGE=31536000  # 1 year (development), 2 years (production)
SECURITY_HEADER_CSP_DIRECTIVES=default-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src 'self' ws: wss:
SECURITY_HEADER_FRAME_OPTIONS=SAMEORIGIN  # SAMEORIGIN (dev), DENY (production)

# WebSocket Origin Security Configuration
# Comma-separated list of allowed origins for WebSocket connections
# Protects against Cross-Site WebSocket Hijacking (CSWSH)
# Supports exact matches, wildcard subdomains (*.example.com), and wildcard ports (localhost:*)
# Development: Use localhost with wildcard ports for convenience
# Production: Must use HTTPS origins only, no localhost
# Examples:
#   - Exact: https://app.example.com
#   - Wildcard subdomain: https://*.example.com (matches app.example.com, dev.app.example.com)
#   - Wildcard port: http://localhost:* (matches any port on localhost)
# See docs/WEBSOCKET_SECURITY.md for detailed configuration guide
WEBSOCKET_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173,http://localhost:5174

# WebSocket Connection Limits & Security
# Maximum message size in bytes (default: 512KB)
# Prevents memory exhaustion from large messages
WEBSOCKET_MAX_MESSAGE_SIZE=524288

# Maximum concurrent connections per workflow (default: 50)
# Prevents resource exhaustion from too many concurrent editors
WEBSOCKET_MAX_CONNECTIONS_PER_WORKFLOW=50

# Rate limit for new WebSocket connections per tenant per minute (default: 60)
# Prevents connection flooding attacks
WEBSOCKET_CONNECTIONS_PER_TENANT_PER_MINUTE=60

# AI Workflow Builder Configuration
# Enable the AI-powered workflow builder feature
AI_BUILDER_ENABLED=false               # Set to true to enable AI workflow generation
AI_BUILDER_PROVIDER=openai             # LLM provider: openai, anthropic, or bedrock
AI_BUILDER_API_KEY=                    # API key for the LLM provider (OpenAI or Anthropic)
                                       # For AWS Bedrock, use AWS credentials above instead
AI_BUILDER_MODEL=gpt-4                 # Model ID: gpt-4, gpt-4-turbo, claude-3-opus, etc.
AI_BUILDER_MAX_TOKENS=4096             # Maximum tokens for completion
AI_BUILDER_TEMPERATURE=0.7             # Temperature (0.0-1.0): lower = more focused
